$(document).ready(function(){function t(){function p(e){var t=new google.maps.LatLng(e.coords.latitude,e.coords.longitude);b(t,null)}function d(e){console.log("getCurrentPosition() failed: "+e.message)}function m(){var t={zoom:13,center:new google.maps.LatLng(i,s),styles:a,panControl:false,zoomControl:true,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.LEFT_CENTER},streetViewControl:false,mapTypeControl:false};f.map=new google.maps.Map(document.getElementById("map-canvas"),t);google.maps.event.addListener(f.map,"click",function(e){b(e.latLng,null)});l=new google.maps.Geocoder;w();var n=document.getElementById("responsiveInfo");var r=document.getElementById("pac-input");var o=document.getElementById("aboutIcon");var u=document.getElementById("oa-logo");var c=document.getElementById("vatx-logo");o.index=1;o.style.cursor="help";f.map.controls[google.maps.ControlPosition.TOP_RIGHT].push(o);n.index=1;f.map.controls[google.maps.ControlPosition.TOP_LEFT].push(n);r.index=1;f.map.controls[google.maps.ControlPosition.LEFT_TOP].push(r);u.index=1;f.map.controls[google.maps.ControlPosition.BOTTOM_LEFT].push(u);c.index=1;f.map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(c);if(e["g"]!=false){navigator.geolocation.getCurrentPosition(p,d,v)}}function g(e,t){f.alertText(e);switch(t){case"ERROR":$("#alerts").addClass("alert-danger").removeClass("alert-info").removeClass("alert-warning");break;case"WARNING":$("#alerts").addClass("alert-warning").removeClass("alert-info").removeClass("alert-danger");break;case"INFO":default:$("#alerts").addClass("alert-info").removeClass("alert-warning").removeClass("alert-danger");break}f.alert(e)}function y(t){var n=o+"/search?latitude="+t.lat()+"&longitude="+t.lng();if(e["time"]!=""){n=n+"&time="+e["time"]}return n}function b(e,t){function r(e){if(n)console.log("jsonpCallback()",{response:e});if(e.message){g(e.message.content,e.message.severity)}if(e.districts){if(e.districts.precinct){f.preID(e.districts.precinct.id)}if(e.districts.city_council){f.coID(e.districts.city_council.id)}}var t=new RegExp("\\n","g");$.each(e.places,function(n,r){var i=new google.maps.LatLng(r.location.latitude,r.location.longitude);var s="mapicons/icon_vote";switch(r.type){case"EARLY_VOTING_FIXED":s+="_early";break;case"EARLY_VOTING_MOBILE":s+="_mobile";break}if(!r.is_open)s+="_closed";s+=".png";var o=new google.maps.MarkerImage(s);var u=new google.maps.Marker({position:i,map:f.map,icon:o,title:r.title,draggable:false});var a='<div id="content" style="max-height:300px; overflow: auto;"><div id="bodyContent"><p>'+r.info.replace(t,"<br/>")+"</p></div></div>";u.infowindow=new google.maps.InfoWindow({maxWidth:250,content:a});var l=e.places[n].location;google.maps.event.addListener(u,"click",function(){$.each(f.votingPlaceMarkers,function(e,t){f.votingPlaceMarkers[e].infowindow.close()});u.infowindow.open(f.map,u);f.psName(l.name);f.psAd(l.address+", "+l.city+", "+l.state);f.psLatlng=new google.maps.LatLng(l.latitude,l.longitude)});f.votingPlaceMarkers.push(u)});f.spinner(false)}if(n)console.log("setCurrentLocation()",{latLng:e,address:t});f.map.panTo(e);f.map.clearMarkers();f.spinner(true);f.preID("?");f.preCheck(false);if(f.preOverlay){f.preOverlay.setMap(null)}f.preOverlay=null;f.coID("?");f.coCheck(false);if(f.coOverlay){f.coOverlay.setMap(null)}f.coOverlay=null;if(f.currentLocMarker==null){f.currentLocMarker=new google.maps.Marker({position:e,map:f.map,title:"You are here. Click map to change position."})}else{f.currentLocMarker.setPosition(e)}var i=y(e);$.ajax({url:i,dataType:"jsonp",error:function(e,t,n){alert(n.message)},success:r});if(!t||t==""){f.currentLocAddress(null);l.geocode({location:e},function(e,t){if(t===google.maps.GeocoderStatus.OK){f.currentLocAddress(e[0].formatted_address)}})}else{f.currentLocAddress(t)}return false}function w(){var e=document.getElementById("pac-input");E(e)}function E(e){var t={bounds:u,rankBy:google.maps.places.RankBy.DISTANCE,componentRestrictions:{country:"us"}};var n=new google.maps.places.Autocomplete(e,t);google.maps.event.addListener(n,"place_changed",function(){var e=n.getPlace();b(e.geometry.location,e.formatted_address)})}var n=true;var r="map_canvas";var i=30.2649;var s=-97.747;var o="http://svc.voteatx.us";var u=new google.maps.LatLngBounds(new google.maps.LatLng(30.2,-97.9),new google.maps.LatLng(30.5,-97.5));var a=[{featureType:"all",stylers:[{saturation:60},{lightness:20},{hue:"#0000BB"}]}];var f=this;f.map=null;f.spinner=ko.observable(false);f.alert=ko.observable(false);f.about=ko.observable(false);f.alertText=ko.observable("");f.currentLocAddress=ko.observable("");f.currentLocMarker=null;f.votingPlaceMarkers=[];f.psAd=ko.observable("");f.psName=ko.observable("nearby polling stations");f.psLatlng=null;f.preID=ko.observable('<i class="fa fa-lg fa-arrow-down"></i>');f.preIsValid=ko.pureComputed(function(){return f.preID()>0});f.preCheck=ko.observable(false);this.preCheck.subscribe(function(e){this.toggleOverlay("precinct",e)},this);f.preOverlay=null;f.coID=ko.observable("<i class='fa fa-lg fa-arrow-down'></i>");f.coIsValid=ko.pureComputed(function(){return f.coID()>0});f.coCheck=ko.observable(false);this.coCheck.subscribe(function(e){this.toggleOverlay("city_council",e)},this);f.coOverlay=null;var l;var c;var h=new google.maps.DirectionsService;var v={enableHighAccuracy:true,maximumAge:3e4,timeout:27e3};google.maps.event.addDomListener(window,"load",m);google.maps.Map.prototype.clearMarkers=function(){for(var e=0;e<f.votingPlaceMarkers.length;e++){f.votingPlaceMarkers[e].setMap(null)}f.votingPlaceMarkers=[]};t.prototype.dismissAlert=function(){f.alert(false)};t.prototype.showAbout=function(){f.about(true)};t.prototype.hideAbout=function(){f.about(false)};t.prototype.toggleAbout=function(){if(f.about()===false)f.about(true);else f.about(false)};}var e;(function(){var t,n=/\+/g,r=/([^&=]+)=?([^&]*)/g,i=function(e){return decodeURIComponent(e.replace(n," "))},s=window.location.search.substring(1);e={};while(t=r.exec(s))e[i(t[1])]=i(t[2])})();ko.applyBindings(new t)})